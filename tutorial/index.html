
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A minimal boilerplate logger for functions.">
      
      
      
        <link rel="canonical" href="https://josh-read.github.io/declog/tutorial/">
      
      
        <link rel="prev" href="../basic_usage/">
      
      
        <link rel="next" href="../reference/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.5">
    
    
      
        <title>Tutorial - DecLog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7a7fce14.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DecLog" class="md-header__button md-logo" aria-label="DecLog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DecLog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/josh-read/declog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    josh-read/declog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DecLog" class="md-nav__button md-logo" aria-label="DecLog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DecLog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/josh-read/declog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    josh-read/declog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic_usage/" class="md-nav__link">
        Basic Usage
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tutorial
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-custom-unique-keys" class="md-nav__link">
    Setting custom unique keys
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manually-setting-key-values" class="md-nav__link">
    Manually setting key values
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-custom-database" class="md-nav__link">
    Using a custom database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#capturing-information-about-the-environment" class="md-nav__link">
    Capturing information about the environment
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        API Reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dev_guide/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-custom-unique-keys" class="md-nav__link">
    Setting custom unique keys
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manually-setting-key-values" class="md-nav__link">
    Manually setting key values
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-custom-database" class="md-nav__link">
    Using a custom database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#capturing-information-about-the-environment" class="md-nav__link">
    Capturing information about the environment
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="tutorial">Tutorial</h1>
<p>This tutorial is written to demonstrate some useful functionality
built into the DecLog library, as well as how to write your own Database
backend and extend the BaseLogger.</p>
<p>Say for example, that we want to overhaul the way we record analysis
results at a research lab.</p>
<p>Our research lab has an extensive analysis library, providing well tested
and documented functions and classes for performing common analysis
routines on our experimental data. Each experiment involves firing a 'shot'
on one of the machines, and a number of measurements are made depending on
the interaction between the machine and the load.</p>
<p>Let's create an object representing the various options for a machine containing
all the possible machines. Using an Enum, we can store the different machine names
with the corresponding folder number:</p>
<pre><code class="language-python">from enum import Enum


class FacilityMachines(Enum):
    &quot;&quot;&quot;Used to generate filepath of metadata directories. Machine number corresponds to
    folder number in /data&quot;&quot;&quot;

    M2 = 2
    M3 = 3
</code></pre>
<h2 id="setting-custom-unique-keys">Setting custom unique keys</h2>
<p>The most basic customisation one can make to the BaseLogger
is to add custom keys. In fact, all the DefaultLogger does is
inherit from the BaseLogger, set the database to the PickleDatabase
and set the database keys to the function name and datetime.</p>
<p>At our research lab, every experiment is conducted on one of several
machines and is assigned a shot number. So for example, two separate
experiments could be conducted on Machine A and Machine B but they
could share the same shot number.</p>
<p>Clearly, we need to differentiate between these experiments, so we need
to set the keys to make this clear:</p>
<pre><code class="language-python">from declog.logger import BaseLogger
from declog.database import BaseDatabase

class FacilityLogger(BaseLogger):
    db = BaseDatabase()
    unique_keys = &quot;machine shot_number function_name datetime&quot;.split()
</code></pre>
<p>Now, when the FacilityLogger is applied to a function, every time the function
is run a new entry
will be created in the underlying database, using the captured values
in the order
specified in <code>unique_keys</code>.</p>
<h2 id="manually-setting-key-values">Manually setting key values</h2>
<p>The intention of this library is to reduce work for developers by automatically logging all the arguments supplied to an
analysis function. However, due to the key system, it is required to supply some variables for logging, even if they are
not actually required by the function. One option is to make the key a redundant argument to the function, this is
inconsistent with PEP8 and will not pass flake8 checks. Instead, one can use the <code>set()</code> class method from the
BaseLogger.</p>
<pre><code class="language-python">from examples.facility_example.logger import FacilityLogger, FacilityMachines


@FacilityLogger
def my_processing_function_for_any_machine(machine: FacilityMachines, shot_number: int):
    return machine.value * shot_number


@FacilityLogger.set(machine=FacilityMachines.M3)
def my_processing_function_for_m3(shot_number: int):
    return shot_number
</code></pre>
<h2 id="using-a-custom-database">Using a custom database</h2>
<p>So far, our Logger uses the BaseDatabase, which is an abstract type that
defines how a database is stored in memory, but doesn't specify any
persistent file format. There are a couple of built-in options, but this
example will demonstrate how to create your own.</p>
<p>This research lab already has its own data storage protocol, each machine
has a json file which is used to log shot variables for that machine. See
below for this illustrated as a tree diagram.</p>
<pre><code>.
└── data/
    ├── 02_M2/
    │   ├── metadata/
    │   │   └── shot_db.json
    │   ├── raw_data/
    │   │   ├── s0001
    │   │   ├── s0002
    │   │   └── ...
    │   └── processed_data/
    │       ├── s0001
    │       ├── s0002
    │       └── ...
    └── 03_M3/
        └── ...
</code></pre>
<p>In order to go between the database interface used by the logger and our own
custom storage format, we need to create a custom database:</p>
<pre><code class="language-python">class FacilityDatabase(PersistentDatabase):
    def __init__(self):
        db_paths = self.gen_db_paths()
        self.dbs = {k: JSONDatabase(v) for k, v in db_paths.items()}

    def __getitem__(self, item):
        if isinstance(item, FacilityMachines):
            return self.dbs[item]
        else:
            raise TypeError(
                &quot;The first key when using the FacilityDatabase must be a machine.&quot;
            )

    def __setitem__(self, key, value):
        if isinstance(key, FacilityMachines):
            self.dbs[key] = value

    def __repr__(self):
        print_dict = {}
        for machine, db in self.dbs.items():
            print_dict[machine] = db
        return repr(print_dict)

    def write(self):
        for db in self.dbs.values():
            db.write()

    @staticmethod
    def gen_db_paths():
        machine_databases = {}
        data_path = Path(__file__).parent / &quot;data&quot;
        for machine in FacilityMachines:
            db_path = Path(f&quot;{machine.value:02d}_{machine.name}/metadata/shot_db.json&quot;)
            machine_databases[machine] = data_path / db_path
        return machine_databases


</code></pre>
<p>Finally, we need to supply this as the database to our logger:</p>
<pre><code class="language-python">from declog.logger import BaseLogger
from examples.facility_example.logger import FacilityDatabase

class FacilityLogger(BaseLogger):
    db = FacilityDatabase()
    unique_keys = &quot;machine shot_number function_name datetime&quot;.split()
</code></pre>
<h2 id="capturing-information-about-the-environment">Capturing information about the environment</h2>
<p>So far, we have seen that we are able to log values using
the <code>log</code> function and that the function arguments are captured
automatically by the Logger. But what if we want to automatically
capture information about the environment the function is being called
in?</p>
<p>Let's go back to our example research facility. We would like to know what
version of the code we are running at the time. Given the examples so far,
we have the options of making a <code>log</code> call in every function, or making it
an argument to all functions, neither of which are particularly
maintainable.</p>
<p>DecLog gives us the option of using <code>logged_properties</code>.</p>
<pre><code class="language-python">from declog import logged_property
from declog.logger import DefaultLogger

class MyLogger(DefaultLogger):

    @logged_property
    def meaning_of_life(self):
        return 42


assert MyLogger(lambda: None).meaning_of_life == 42

</code></pre>
<p>These behave just like normal properties, and can be accessed from an
instance at any time. Whenever a decorated function is called, any logged
properties are added to the database entry, and can be used as keys if
desired.</p>
<p>Logged properties are also how the DefaultLogger captures the name of the
function and time of the function call. If we look at the class definition,
we find that it inherits the <code>FunctionNameMixin</code> and <code>DateTimeMixin</code>, each
of which define one <code>logged_property</code> method. In <code>declog.logger.mixins</code>
a few commonly used <code>logged_property</code>s are defined. It is worth taking
a look at these mixins, as they may be useful in your logger.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.407015b8.min.js"></script>
      
    
  </body>
</html>